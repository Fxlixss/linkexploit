from tdotly import tly
import requests
import pyperclip
import os
import string
import random

token = "PASTE TOKEN HERE" #Make account at https://t.ly and get the APIToken in API tab in the settings (Free) 

short = tly.tly_shorturl()
short.initialize(token)

def getService():
    services = ["discord", "roblox", "youtube", "deletelinks", "listlinks"]
    print("Enter Service (Discord, Roblox, Youtube, DeleteLinks, ListLinks)") 
    service = str(input(": ")).strip().lower()
    if service in [s.lower() for s in services]:
        return service
    else:
        print("Service not found")
        return getService()


service = getService()

if service == "listlinks":
    try:
        base_url = "https://api.t.ly/api/v1/link/list"
        
        headers = {
            "Authorization": f"Bearer {token}",
            "Content-Type": "application/json",
            "Accept": "application/json"
        }
        
        page = 1
        all_items = []
        has_more_pages = True

        while has_more_pages:
            response = requests.get(f"{base_url}?page={page}", headers=headers)
                
            data = response.json()
            items = data.get('data', [])
                    
            if not items:
                    has_more_pages = False
            else:
                all_items.extend(items)
                page += 1
        if all_items:
            for item in all_items:
                short_url = item.get('short_url', 'N/A')
                long_url = item.get('long_url', 'N/A')
                print(f"{short_url} >> {long_url}")
        os.system("pause>nul")
    except:
        pass

elif service == "deletelinks":
    try:
        base_url = "https://api.t.ly/api/v1/link/list"
        headers = {
            "Authorization": f"Bearer {token}",
            "Content-Type": "application/json",
            "Accept": "application/json"
        }
        response = requests.get(base_url, headers=headers)
        try:
            data = response.json()
            short_urls = [item['short_url'] for item in data.get('data', [])]   
            if short_urls:
                for url in short_urls:
                    short.delete_short_url(short_url=url)
            print("Deleted all links")
            os.system("pause>nul")
        except:
            pass
    except:
        pass

elif service == "roblox":
    try:
        print("Enter URL to be redirected to")
        longurl = str(input(": "))
        link = short.create_short_url(long_url=longurl)
        shorturl = f"{random.randint(1000000000, 5000000000)}/profile"
        short.edit_url_settings(current_short_url=link, edit_short_id=f"{shorturl}")
        link = f"@t.ly/{shorturl}"
        link = f"https:/ ̸ www.roblox.com ̸ users ̸ {link}"
        print(link)
        pyperclip.copy(link)
        print("The link has be copied to your clipboard.")
        print("Links can only be used in Discord.")
        os.system("pause>nul")
    except:
        print("URL not allowed")
elif service == "discord":
    try:
        print("Enter URL to be redirected to")
        longurl = str(input(": "))
        link = short.create_short_url(long_url=longurl)
        characters = string.ascii_lowercase + string.ascii_uppercase + string.digits
        shorturl = ''.join(random.choice(characters) for _ in range(24))
        short.edit_url_settings(current_short_url=link, edit_short_id=f"{shorturl}")
        link = f"@t.ly/{shorturl}"
        link = f"https:/ ̸ discord.gift  ̸ {link}"
        print(link)
        pyperclip.copy(link)
        print("The link has be copied to your clipboard.")
        print("Links can only be used in Discord.")
        os.system("pause>nul")
    except:
        print("URL not allowed")
elif service == "youtube":
    try:
        print("Enter URL to be redirected to")
        longurl = str(input(": "))
        link = short.create_short_url(long_url=longurl)
        characters = string.ascii_lowercase + string.ascii_uppercase + string.digits + "-"
        shorturl = f"v={"".join(random.choice(characters) for _ in range(11))}"
        short.edit_url_settings(current_short_url=link, edit_short_id=f"{shorturl}")
        link = f"@t.ly/{shorturl}"
        link = f"https:/ ̸ www.youtube.com ̸ watch  ̸ {link}"
        print(link)
        pyperclip.copy(link)
        print("The link has be copied to your clipboard.")
        print("Links can only be used in Discord.")
        os.system("pause>nul")
    except:
        print("URL not allowed")
